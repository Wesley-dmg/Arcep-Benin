{% extends 'layouts/base.html' %}

{% block title %}
  Détails du Site - {{ site.nom }}
{% endblock %}

{% block content %}
  <!-- Header Section -->
  <div class="header bg-primary pb-6">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center py-1">
          <div class="col-lg-6 col-7">
            <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
              <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                <li class="breadcrumb-item">
                  <a href="#"><i class="fas fa-home"></i></a>
                </li>
                <li class="breadcrumb-item">
                  <a href="#">Sites</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Détails</li>
                <li class="breadcrumb-item active" aria-current="page">{{ site.nom }}</li>
              </ol>
            </nav>
          </div>
          <div class="col-lg-6 col-5 text-right">
            <a href="{% url 'home:site_create' %}" class="btn btn-sm btn-neutral">Ajouter</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% comment %} <div class="header pb-5 d-flex align-items-center" style="min-height: 80px; background-image: url(/static/media/{{ site.photo }}); background-size: cover; background-position: center top;">
    <span class="mask bg-gradient-primary opacity-0"></span>
    <div class="container-fluid d-flex align-items-center">
      <div class="row">
        <div class="col-auto">
          <p class="text-white mt-0 mb-5 mt-2 d-flex">
            <img src="/static/media/{{ site.operateur.logo }}" alt="{{ site.operateur.nom }}" style="max-width: 40px; margin-right: 1rem;" />
            <span class="font-weight-600" style="font-size: 22px;">Détails de {{ site.nom }}</span>
          </p>
        </div>
      </div>
    </div>
  </div> {% endcomment %}
    {% if messages %}
      <div class="alert-messages">
        {% for message in messages %}
          <div class="alert {% if message.tags %} alert-{{ message.tags }} {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  <!-- Main Content -->
  <div class="container-fluid mt--6">
    <div class="row">
      <!-- Profile Card -->
      <div class="col-xl-5 order-xl-1 mb-5 mb-xl-0">
        <div class="card card-profile">
          {% if site.photo %}
            <img src="/static/media/{{ site.photo }}" alt="{{ site.nom }}" class="card-img-top" />
          {% else %}
            <img src="/static/media/notavailable.png" alt="" class="card-img-top" />
          {% endif %}

          <div class="card-body pt-0">
            <div class="row">
              <div class="col">
                <div class="card-profile-stats d-flex justify-content-center">
                  <div>
                    <span class="heading">{{ site.latitude }}</span>
                    <span class="description">Latitude</span>
                  </div>
                  <div>
                    <span class="heading">{{ site.longitude }}</span>
                    <span class="description">Longitude</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="text-center">
              <div>
                <strong>{{ site.nom }}</strong>
              </div>
              <div class="mt-3">{{ site.emplacement }}</div>
              <div class="mt-3">{{ site.localite }}</div>
              <div class="mt-3">{{ site.date_mise_en_service|date:'d M Y' }}</div>
            </div>
            <div class="mt-3">
              <a href="{% url 'home:site_update' site.id %}" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i> Modifier</a>
              <a href="{% url 'home:site_delete' site.id %}" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i> Supprimer</a>
            </div>
            <hr class="my-4" />

            <!-- Additional Information -->
            <div class="mt-4">
              <div class="card-header">
                <h3 class="mb-0">Rapport d'analyse</h3>
              </div>
              <p><strong>Référence de courrier :</strong> {{ site.ref_courrier }}</p>
              <p><strong>Date d'autorisation :</strong> {{ site.date_autorisation|date:'d M Y' }}</p>
              <p><strong class="text-muted mb-4">Avis ARCEP :</strong></p>
              <div class="pl-lg-4">
                <p>{{ site.avis_arcep }}</p>
              </div>
              <p><strong class="text-muted mb-4">Observations :</strong></p>
              <div class="pl-lg-4">
                <p>{{ site.observation }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Site Information Section -->
      <div class="col-xl-7 order-xl-2">
        <div class="card">
          <div class="card-header">
            <h3 class="mb-0">Informations sur le site</h3>
          </div>
          <div class="card-body">
            <p><strong>Propriétaire :</strong> {{ site.proprietaire }}</p>
            <p><strong>Numéro de dossier :</strong> {{ site.num_dossier }}</p>

            <!-- Description Section -->
            <h6 class="heading-small text-muted mb-4">Description</h6>
            <div class="pl-lg-4">
              <p>{{ site.description }}</p>
            </div>
            <hr class="my-4" />

            <!-- Technical Details Section -->
            <h6 class="heading-small text-muted mb-4">Détails techniques</h6>
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-auto">
                  <p><strong>Type de pylône :</strong> {{ site.type_pylone }}</p>
                  <p><strong>Hauteur de l'antenne :</strong> {{ site.hauteur_antenne }} m</p>
                  <p><strong>Camouflage :</strong> {{ site.camouflage|yesno:'Oui,Non' }}</p>
                </div>
              </div>
            </div>
            <hr class="my-4" />

            <!-- Conformity Section -->
            <div class="row">
              <h6 class="heading-small text-muted mb-4 col-6">Conformité</h6>
              <div class="col-6">
                {% if site.conformite %}
                  <a href="{% url 'home:update_conformite' site_id=site.id %}" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i> Modifier</a>
                  <a href="{% url 'home:delete_conformite' site_id=site.id %}" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i> Supprimer</a>
                {% else %}
                  <a href="{% url 'home:add_conformite' site.id %}" class="btn btn-sm btn-outline-primary"><i class="fas fa-plus"></i> Ajouter la conformité</a>
                {% endif %}
              </div>
            </div>
            <div class="pl-lg-4">
              {% if site.conformite %}
                <p><strong>Rapport:</strong> <a href=" " class="  ">Rapport PDF Disponible</a></p>
                <p><strong>Statut :</strong> {{ site.conformite.statut|yesno:'Conforme,Non conforme' }}</p>
                <p><strong>Date d'inspection :</strong> {{ site.conformite.date_inspection|date:'d M Y' }}</p>
              {% else %}
                <p>Aucune conformité disponible.</p>
              {% endif %}
            </div>
            <hr class="my-4" />

            <hr class="my-4" />

            <!-- Technologies Section -->
            <h6 class="heading-small text-muted mb-4">Technologies</h6>
            <div class="pl-lg-4">
              <p>
                {% for technologie in site.technologies.all %}
                  {{ technologie.nom }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
